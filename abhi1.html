<html>

<head>
    <script src="/js/three.js"></script>
    <script src="/js/Sky.js"></script>
    <script type="text/javascript" src="js/physi.js"></script>
    <script src="/js/OrbitControls.js"></script>
    <!-- <script src="/js/dat.gui.module.js"></script>  -->

    <style>
        #container {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        body {
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <!-- <audio autoplay>

        <source src="audio/main.mp3" type="audio/mpeg">

    </audio> -->

    <script type="text/javascript">

        'use strict';


        Physijs.scripts.worker = '/js/physijs_worker.js';
        Physijs.scripts.ammo = ' /js/ammo.js';

        var track_geometry, track_material;
        var track_array = [];

        var star_geometry, star_material;
        var star_array = [];

        const container = document.getElementById('container');
        const scene = new Physijs.Scene();
        var sky, sunSphere;
        scene.background = new THREE.Color('skyblue');

        // const camera = new THREE.PerspectiveCamera(70, container.clientWidth / container.clientHeight, 0.01, 300);
        // camera.position.set(0, 10, 6);
        // camera.rotateX(-Math.PI / 8);
//try camera
const camera = new THREE.PerspectiveCamera(
                35,
                window.innerWidth / window.innerHeight,
                1,
                1000
            );
            camera.position.set(60, 50, 60);
            camera.lookAt(scene.position);
            scene.add(camera);


        function createSky() {
            // Add Sky
            const sky = new THREE.Sky();
            sky.scale.setScalar(200);
            sky.name = 'Sky';
            scene.add(sky);

            // Add Sun Helper
            const sunSphere = new THREE.Mesh(
                new THREE.SphereBufferGeometry(20000, 16, 8),
                new THREE.MeshBasicMaterial({
                    color: 0xffffff
                })
            );
            sunSphere.position.y = 700000;
            sunSphere.visible = false;
            scene.add(sunSphere);

            const effectController = {
                turbidity: 10,
                rayleigh: 2,
                mieCoefficient: 0.005,
                mieDirectionalG: 0.8,
                luminance: 1,
                inclination: 0.49, // elevation / inclination
                azimuth: 0.25, // Facing front,
                sun: !true
            };
            const distance = 400000;

            const uniforms = sky.material.uniforms;
            uniforms["turbidity"].value = effectController.turbidity;
            uniforms["rayleigh"].value = effectController.rayleigh;
            uniforms["luminance"].value = effectController.luminance;
            uniforms["mieCoefficient"].value = effectController.mieCoefficient;
            uniforms["mieDirectionalG"].value = effectController.mieDirectionalG;
            const theta = Math.PI * (effectController.inclination - 0.5);
            const phi = 2 * Math.PI * (effectController.azimuth - 0.5);
            sunSphere.position.x = distance * Math.cos(phi);
            sunSphere.position.y = distance * Math.sin(phi) * Math.sin(theta);
            sunSphere.position.z = distance * Math.sin(phi) * Math.cos(theta);
            sunSphere.visible = effectController.sun;
            uniforms["sunPosition"].value.copy(sunSphere.position);

        }


        createSky();

        var ball;
        var ball_geometry = new THREE.SphereGeometry(0.7, 20, 20, 0, Math.PI * 2, 0, Math.PI * 2);
        var ball_material = new THREE.MeshStandardMaterial({
            color: 0xFF0000,
            shading: THREE.FlatShading
        })
        ball = new Physijs.Mesh(ball_geometry, ball_material);
        ball.receiveShadow = true;
        ball.castShadow = true;
        ball.position.set(0, 6, 2);
        //scene.add(ball);
      // try
        var ball;
        var ball_geometry = new THREE.SphereGeometry(0.7, 20, 20, 0, Math.PI * 2, 0, Math.PI * 2);
        var ball_material = new THREE.MeshPhongMaterial({
            color: 0xFF0000,
            shading: THREE.FlatShading
        })
        ball = new Physijs.SphereMesh(ball_geometry, ball_material);
        //ball.receiveShadow = true;
        //ball.castShadow = true;
        ball.position.set(0, 10, 2);
        scene.add(ball);
        //const geometry = new THREE.SphereBufferGeometry( 2, 32, 32 );

        var p = 0;
        var sub, colm;
        track_geometry = new THREE.PlaneBufferGeometry(10, 10);
        track_material = new THREE.MeshStandardMaterial({
            color: 0xFF0000
        });
        for (var d = 0; d < 50; d++) {
            track_array[d] = new Physijs.BoxMesh(track_geometry, track_material);
            track_array[d].position.set(0, 5, -14 * p);
            track_array[d].rotateX(-Math.PI / 2);
            p++;
            scene.add(track_array[d]);

            star_geometry = new THREE.BoxBufferGeometry(.5, 0, 2);
            star_material = new THREE.MeshStandardMaterial({
                color: 0x0000FF
            });

            star_array[d] = new THREE.Mesh(star_geometry, star_material);
            star_array[d].position.set(0, 5, -14 * p);

            //scene.add(star_array[d]);
        }

        const light = new THREE.DirectionalLight(0x404040, 5);
        scene.add(light);

        const renderer = new THREE.WebGLRenderer({
            antialias: true
        });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);

        container.appendChild(renderer.domElement);
        renderer.render(scene, camera);

        var xi = 1;

        var clock = new THREE.Clock();
        console.log(clock);
        var time = 0;
        var delta = 0;

        function animate() {

            for (var f = 0; f < 50; f++) {
                track_array[f].position.z += 0.175;
                track_array[f].__dirtyPosition = true;
                star_array[f].position.z += 0.139;
                star_array[f].__dirtyPosition = true;
            }

            delta = clock.getDelta();

            time += delta;

            ball.rotation.x -= 0.185;
            ball.__dirtyRotation = true;
            scene.simulate(); // run physics

            requestAnimationFrame(animate);
            renderer.render(scene, camera);
            // scene.add(ball);
        }



        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;

            renderer.setSize(container.clientWidth, container.clientHeight);
            camera.updateProjectionMatrix();
        }

        window.addEventListener('resize', onWindowResize);
        function bounce() {

            ball.position.y = 6 + Math.abs(Math.sin(time * 5)) * 3;

            // setTimeout(function(){ball.position.set(0, 6, 2);},500) ;
        }
        var ballLefRight = 0;
        function ballMoveLeft() {
            var diff = 0.1;
            ballLefRight = ballLefRight - diff;
            ball.position.set(ballLefRight, 6, 2);
            if (ballLefRight <= -5) {
                //let Vector3  = new Vector3 (moveHorizontal, 0, 0);
                //ball.setGravity(new THREE.Vector3(0, -10, 0));
                //ball.simulate();
                ball.position.set(-5, -0.39, 0);
                /*ball.gravity = 0.05;
                ball.gravitySpeed = 0;
                ball.x = x;
                ball.y = y; 
               ball.speedX = 0;
               ball.speedY = 0; 
               function() {
               ball.gravitySpeed += ball.gravity;
               ball.x += ball.speedX;
               ball.y += ball.speedY + ball.gravitySpeed; 
                  }*/
                // alert("hello");
                //document.write("<h1>Game Over</h1>")
                setTimeout(function () {

                    //alert("Game over");
                    document.write("<h1>Game Over</h1>")
                    return false
                }, 10)
            }
        }
        function ballMoveRight() {
            var diff = 0.1;
            ballLefRight = ballLefRight + diff;
            ball.position.set(ballLefRight, 6, 2);
            if (ballLefRight >= 5) {
                ball.position.set(5, -0.39, 0);
                setTimeout(function () {

                    //alert("Game over");
                    document.write("<h1>Game Over</h1>")
                    return false
                }, 10)
            }

            //let Vector3  = new Vector3 (moveHorizontal, 0, 0);
            //ball.setGravity(gravity: Vector3 );
            //alert("hello");
            //document.write("<h1>Game Over</h1>")
        }





        document.body.onkeydown = function (e) {

            switch (e.keyCode) {
                case 32: bounce(); break;

                case 39: ballMoveRight(); break;
                case 37: ballMoveLeft();

            }
        }

        animate();

    </script>
</body>

</html>